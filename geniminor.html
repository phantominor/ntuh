<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç—…æ­·å„ªåŒ–åŠ©æ‰‹ (Proç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; padding: 40px; max-width: 900px; margin: 0 auto; background-color: #f9f9f9; }
        h1 { color: #2c3e50; }
        
        .container { display: flex; gap: 20px; flex-direction: column; }
        
        textarea { 
            width: 100%; height: 150px; padding: 15px; 
            border: 1px solid #ccc; border-radius: 8px; 
            font-family: monospace; font-size: 14px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’é–‹å¯¬åº¦ */
        }

        button { 
            padding: 12px 24px; background-color: #007bff; color: white; 
            border: none; border-radius: 5px; cursor: pointer; font-size: 16px; 
            align-self: flex-start; transition: background 0.3s;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* æ¨¡æ“¬ç—…æ­·ç´™çš„æ¨£å¼ */
        #output { 
            background: white; padding: 30px; border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            line-height: 1.6; color: #333; min-height: 200px;
        }
        
        /* è®“ Markdown çš„è¼¸å‡ºæ›´å¥½çœ‹ */
        #output h3 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 20px; }
        #output ul { padding-left: 20px; }
        #output strong { color: #d9534f; } /* å¼·èª¿é‡é»é¡¯ç¤ºç´…è‰² */
    </style>
</head>
<body>

    <h1>ğŸ¥ AI ç—…æ­·å„ªåŒ–åŠ©æ‰‹ (Gemini 2.5 Pro)</h1>
    <p>è«‹è¼¸å…¥é›œäº‚çš„è‡¨åºŠç­†è¨˜æˆ–åˆæ­¥ç—…æ­·ï¼ŒAI å°‡å”åŠ©æ‚¨æ•´ç†ç‚ºæ¨™æº– SOAP æ ¼å¼ä¸¦é€²è¡Œå„ªåŒ–ã€‚</p>

    <div class="container">
        <textarea id="promptInput" placeholder="ç¯„ä¾‹è¼¸å…¥ï¼š
56æ­²ç”·æ€§ï¼Œæ˜¨å¤©é–‹å§‹å³ä¸‹è…¹ç—›ï¼Œæœ‰å™å¿ƒæ„Ÿï¼Œé«”æº«37.8ï¼Œç™½è¡€çƒ12000ï¼ŒMcBurney pointå£“ç—›æ˜é¡¯ï¼Œæ‡·ç–‘æ˜¯ç›²è…¸ç‚..."></textarea>
        
        <button id="generateBtn">é–‹å§‹å„ªåŒ–ç—…æ­·</button>
        
        <div id="output">ç­‰å¾…è¼¸å…¥...</div>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <script type="module">
      import { GoogleGenerativeAI } from "@google/generative-ai";

      // â˜…â˜…â˜… è¨˜å¾—æ›å›æ‚¨çš„ API Key â˜…â˜…â˜…
      const API_KEY = "AIzaSyAI6B2ZzzaYf9hxewBcZj_0QrbfDP9gvDs";

      const genAI = new GoogleGenerativeAI(API_KEY);

      // â˜… é—œéµè¨­å®š 1ï¼šä½¿ç”¨æ€è€ƒèƒ½åŠ›è¼ƒå¼·çš„ Pro æ¨¡å‹ â˜…
      // â˜… é—œéµè¨­å®š 2ï¼šSystem Instruction (è§’è‰²æ‰®æ¼”) â˜…
      const model = genAI.getGenerativeModel({ 
          model: "gemini-2.5-flash",
          systemInstruction: `
            Please polish the following content of my note into paragraphs of chief complaint (in a sentence), present illness, and past history. Please write in fluent and professional medical English and make sure that it follows the timeline and with medical logic. Make sure all first names of people or doctors, and all name of hospitals mentioned preserved in Chinese, and make sure all time are formatted in yyyy/mm/dd or yyyy/mm if no date is presented.
Please organize all the things into the following format, and generate things in a plain text code box for convenient copying:
[Chief complaint]
Informant: patient and EMR
CC: (symptom, for how long.)
[Present illness] (ensure that every disease is started with "#. " and the s/p procedure followed by "  - ")
This is a ?-year-old male/female with underlying diseases of:
#. Disease A. (Preserve all s/p procedures) (make all procedures in smooth timeline)
#. Disease B, etc. (preserve all underlying diseases as the start of the present illness)
(Paragraph starts.)
[Past history]
(Paragraphs starts, while if there's no important history unrelated to current event, then output "as the above")
[Other trivial details]
(Things that don't actually matters but are recorded in my note can be put here)
And below is my note of this patient's history.
=== Chief complaint === (brief out the patient's major complaint in a sentence)
${chiefComplaintInput}
=== History taken === (all the things that are related with the chief complaint should be put in present illness, and other important history that are unrelated with current events should be put in past history, while yet the other trivial things placed in extra section.)
${historyTakenInput}`
      });

      const outputDiv = document.getElementById('output');
      const btn = document.getElementById('generateBtn');
      const input = document.getElementById('promptInput');

      btn.addEventListener('click', async () => {
          const prompt = input.value;
          if (!prompt) return;

          btn.disabled = true;
          btn.textContent = "é†«å¸«æ€è€ƒä¸­...";
          outputDiv.innerHTML = "æ­£åœ¨åˆ†æç—…æƒ…ä¸¦æ’°å¯«ç—…æ­·..."; // æš«æ™‚é¡¯ç¤º
          
          try {
              const result = await model.generateContent(prompt);
              const response = await result.response;
              const text = response.text();
              
              // â˜… é—œéµè¨­å®š 3ï¼šä½¿ç”¨ marked å°‡ Markdown è½‰æ›ç‚º HTML â˜…
              outputDiv.innerHTML = marked.parse(text);
          } catch (error) {
              outputDiv.innerHTML = `<span style="color:red">ç™¼ç”ŸéŒ¯èª¤: ${error.message}</span>`;
              console.error(error);
          } finally {
              btn.disabled = false;
              btn.textContent = "é–‹å§‹å„ªåŒ–ç—…æ­·";
          }
      });
    </script>
</body>
</html>