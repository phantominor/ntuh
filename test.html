<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Loading Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        
        .test-container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        input[type="text"] {
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        
        #result {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eee;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>File Loading Test</h1>
    
    <div class="test-container">
        <h2>Test File Access</h2>
        <p>Enter the file path to test loading (e.g., /osce.txt):</p>
        
        <input type="text" id="filePath" value="/osce.txt" placeholder="Enter file path">
        
        <div class="button-row">
            <button id="testBtn">Test File Loading</button>
            <button id="clearBtn">Clear Results</button>
        </div>
        
        <div id="status" class="status info">
            Enter a file path and click "Test File Loading" to begin.
        </div>
        
        <h3>File Contents (Preview):</h3>
        <div id="result">Results will appear here...</div>
    </div>
    
    <div class="test-container">
        <h2>Parse Test</h2>
        <p>Enter the separator used in your file (e.g., ===):</p>
        <input type="text" id="separator" value="===" placeholder="Enter separator">
        <button id="parseBtn" disabled>Parse File Content</button>
        
        <div id="parseStatus" class="status info">
            Load a file first, then parse the content.
        </div>
        
        <h3>Parsed Items:</h3>
        <div id="parseResult">Parse results will appear here...</div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const testBtn = document.getElementById('testBtn');
            const clearBtn = document.getElementById('clearBtn');
            const parseBtn = document.getElementById('parseBtn');
            const filePathInput = document.getElementById('filePath');
            const separatorInput = document.getElementById('separator');
            const statusDiv = document.getElementById('status');
            const parseStatusDiv = document.getElementById('parseStatus');
            const resultDiv = document.getElementById('result');
            const parseResultDiv = document.getElementById('parseResult');
            
            let fileContent = '';
            
            // Test file loading
            testBtn.addEventListener('click', async () => {
                const filePath = filePathInput.value.trim();
                
                if (!filePath) {
                    updateStatus('Please enter a file path', 'error');
                    return;
                }
                
                try {
                    updateStatus('Loading file...', 'info');
                    const content = await window.fs.readFile(filePath, { encoding: 'utf8' });
                    fileContent = content;
                    
                    // Show preview (first 500 chars)
                    const preview = content.length > 500 
                        ? content.substring(0, 500) + '... (truncated)'
                        : content;
                    
                    resultDiv.textContent = preview;
                    
                    updateStatus(
                        `Success! File loaded (${content.length} characters). ` +
                        `First 500 characters shown below.`, 
                        'success'
                    );
                    
                    // Enable parse button
                    parseBtn.disabled = false;
                    updateParseStatus('File loaded. Click "Parse File Content" to analyze.', 'info');
                    
                } catch (error) {
                    console.error('Error loading file:', error);
                    updateStatus(
                        `Error loading file: ${error.message || 'Unknown error'}. ` +
                        `Verify the file exists at the specified path.`, 
                        'error'
                    );
                    resultDiv.textContent = 'Error loading file. See status message above.';
                    parseBtn.disabled = true;
                }
            });
            
            // Parse file content
            parseBtn.addEventListener('click', () => {
                const separator = separatorInput.value.trim();
                
                if (!separator) {
                    updateParseStatus('Please enter a separator', 'error');
                    return;
                }
                
                if (!fileContent) {
                    updateParseStatus('No file content to parse. Load a file first.', 'error');
                    return;
                }
                
                try {
                    // Split content by separator
                    const items = fileContent.split(separator).map(item => item.trim()).filter(item => item);
                    
                    if (items.length === 0) {
                        updateParseStatus('No items found using this separator.', 'error');
                        parseResultDiv.innerHTML = 'No items found.';
                        return;
                    }
                    
                    updateParseStatus(`Successfully parsed ${items.length} items!`, 'success');
                    
                    // Create item preview
                    let html = `<p><strong>Found ${items.length} items:</strong></p><ul>`;
                    
                    items.forEach((item, index) => {
                        if (index < 5) {
                            // For first 5 items, show preview
                            const preview = item.length > 100 
                                ? item.substring(0, 100) + '...' 
                                : item;
                            html += `<li>Item ${index + 1}: ${preview}</li>`;
                        } else if (index === 5) {
                            html += `<li>... and ${items.length - 5} more items</li>`;
                        }
                    });
                    
                    html += '</ul>';
                    parseResultDiv.innerHTML = html;
                    
                } catch (error) {
                    console.error('Error parsing content:', error);
                    updateParseStatus(`Error parsing content: ${error.message || 'Unknown error'}`, 'error');
                }
            });
            
            // Clear results
            clearBtn.addEventListener('click', () => {
                resultDiv.textContent = 'Results will appear here...';
                parseResultDiv.innerHTML = 'Parse results will appear here...';
                updateStatus('Results cleared', 'info');
                updateParseStatus('Results cleared', 'info');
                fileContent = '';
                parseBtn.disabled = true;
            });
            
            function updateStatus(message, type) {
                statusDiv.textContent = message;
                statusDiv.className = `status ${type}`;
            }
            
            function updateParseStatus(message, type) {
                parseStatusDiv.textContent = message;
                parseStatusDiv.className = `status ${type}`;
            }
        });
    </script>
</body>
</html>